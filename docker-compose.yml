version: "3.4"

services:
  siremis:
    build: ./siremis
    ports:
      - 8080:80
    networks:
      - int
      - ext
    entrypoint: "apache2ctl -DFOREGROUND"

  kamailio:
    build: ./kamailio
    ports:
      - 5060:5060/udp
      - 5060:5060
      - 5061:5061
    volumes:
      - ./data/kamailio:/etc/kamailio
    networks:
      - int
      - ext
    entrypoint: "./wait-for-it.sh mysql_kamailio:3306 -- ./entrypoint.sh"
    depends_on:
      - mysql_kamailio
  
  mysql_siremis:
    image: mysql
    env_file: ./siremis/mysql.env
    ports:
      - 3306:3306
    networks: 
      - int
    volumes:
      - ./data/mysql_siremis:/var/lib/mysql
  
  mysql_kamailio:
    image: mysql
    env_file: ./kamailio/mysql.env
    ports:
      - 3307:3306
    networks: 
      - int
    volumes:
      - ./data/mysql_kamailio:/var/lib/mysql

networks:
  int:
  ext:
